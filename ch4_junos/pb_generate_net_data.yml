---
- name: Build Folder Structure
  hosts: all
  connection: local
  gather_facts: no
  tasks:
    - name: Create group_vars Folder
      file: path=group_vars state=directory
      run_once: yes

    - name: Create host_vars Folder
      file: path=host_vars state=directory
      run_once: yes

    - name: Create host_vars Folder
      file: path=host_vars/{{ inventory_hostname }} state=directory


- name: Generate P2P IP address Info 
  hosts: all
  connection: local
  gather_facts: no
  vars_files: 
    - "network_topology.yml"
    - "l3vpn.yml"
  tasks:
    - block:
      - name: "Generate Global Config Data"
        template:
          src: "infra.j2"
          dest: "group_vars/all.yml"
        run_once: yes

      - name: "Generate Host Specifc BGP Data"
        template:
          src: "j2_bgp.j2"
          dest: "host_vars/{{ inventory_hostname }}/bgp.yml"
        tags: bgp

      - name: "Generate L3VPN"
        template:
          src: "l3vpn.j2"
          dest: "host_vars/{{ inventory_hostname }}/l3vpn.yml"
        tags: l3vpn
      delegate_to: localhost

